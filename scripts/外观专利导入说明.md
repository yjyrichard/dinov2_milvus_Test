# 外观专利导入脚本使用说明

## 目录结构说明

### 扁平目录结构 (Flat)
```
data_dir/
├── I20240115/
│   ├── I20240115/
│   │   └── DESIGN/
│   │       ├── USD123456/
│   │       │   └── USD123456/
│   │       │       ├── D123456.XML
│   │       │       ├── image1.jpg
│   │       │       └── image2.jpg
│   │       └── USD789012/
│   │           └── USD789012/
│   │               ├── D789012.XML
│   │               └── image1.jpg
│   └── I20240116/
│       └── I20240116/
│           └── DESIGN/
│               └── USD111111/
│                   └── USD111111/
│                       ├── D111111.XML
│                       └── image1.jpg
```

特点: `DESIGN` 目录下是 `USD*/USD*/` 嵌套结构，XML 和图片在**同一目录**。

### 完整目录结构 (Full) - 已废弃
```
data_dir/
├── I日期/
│   ├── I日期/
│   │   ├── DESIGN/
│   │   │   ├── USD*/  (日期目录)
│   │   │   │   └── USD*/  (专利目录)
│   │   │   │       ├── *.XML
│   │   │   │       └── *.JPG/PNG
```

## 脚本区别

| 特性 | `import_design_patents_flat.py` | `import_design_patents_full.py` |
|------|--------------------------------|--------------------------------|
| 适用目录 | 扁平目录结构 (XML和图片同目录) | 完整目录结构 (XML和图片分离) |
| 图片路径 | `patent.image_dir` (XML同级) | `patent.data_dir` (父目录) |
| Parser | `design_patent_parser_flat.py` | `design_patent_parser.py` |
| 状态 | 当前使用 | 已废弃 |

## 使用命令

### 扁平目录 (当前使用)
```bash
cd D:\dev\develop\dinov2_milvus_Test\scripts

python import_design_patents_flat.py --data-dir "D:\data" --append
```

### 完整目录 (已废弃)
```bash
cd D:\dev\develop\dinov2_milvus_Test\scripts

python import_design_patents_full.py --data-dir "D:\data" --append
```

## 重要提示

1. **必须使用 `--append` 参数**
   - 不加 `--append` 程序会直接退出，防止误删数据
   - `--append` 表示追加模式，不会删除现有 collection

2. **去重机制**
   - 脚本会自动跳过已存在的记录 (根据 `patent_id + file_name` 判断)
   - 不用担心重复导入

3. **数据存储**
   - Collection: `design_patents_full`
   - 图片存储: MinIO (路径: `design_patents/{patent_id}/{filename}`)
